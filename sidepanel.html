<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Email Assistant</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Backdrop for mobile sidebar -->
    <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

    <!-- Settings Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Settings" aria-label="Toggle settings sidebar">
      <span class="icon">âš™ï¸</span>
      <span class="text">Settings</span>
    </button>

    <!-- Settings Sidebar -->
    <aside class="settings-sidebar" id="settingsSidebar">
      <div class="sidebar-header">
        <h2>âš™ï¸ Settings</h2>
        <button class="sidebar-close" id="sidebarClose" title="Close Settings" aria-label="Close settings sidebar">âœ•</button>
      </div>
      <div class="sidebar-content">
        <!-- API Keys Section -->
    <details id="settings" open>
      <summary>
        <span>ğŸ”‘ API Keys</span>
      </summary>
      <div>
        <!-- OpenAI -->
        <div class="card">
          <h3>
            OpenAI
            <span class="key-status missing" id="status-openai">âœ— No key</span>
          </h3>
          <div class="row">
            <label>API Key</label>
            <div class="input-wrapper">
              <input id="openai_key" type="password" placeholder="sk-..." autocomplete="off" aria-label="OpenAI API Key" />
              <button type="button" class="toggle-password" data-target="openai_key" title="Show/Hide" aria-label="Toggle password visibility">ğŸ‘ï¸</button>
            </div>
          </div>
        </div>

        <!-- Anthropic -->
        <div class="card">
          <h3>
            Anthropic
            <span class="key-status missing" id="status-anthropic">âœ— No key</span>
          </h3>
          <div class="row">
            <label>API Key</label>
            <div class="input-wrapper">
              <input id="anthropic_key" type="password" placeholder="sk-ant-..." autocomplete="off" aria-label="Anthropic API Key" />
              <button type="button" class="toggle-password" data-target="anthropic_key" title="Show/Hide" aria-label="Toggle password visibility">ğŸ‘ï¸</button>
            </div>
          </div>
        </div>

        <!-- Google Gemini -->
        <div class="card">
          <h3>
            Google Gemini
            <span class="key-status missing" id="status-google">âœ— No key</span>
          </h3>
          <div class="row">
            <label>API Key</label>
            <div class="input-wrapper">
              <input id="google_key" type="password" placeholder="AIza..." autocomplete="off" aria-label="Google Gemini API Key" />
              <button type="button" class="toggle-password" data-target="google_key" title="Show/Hide" aria-label="Toggle password visibility">ğŸ‘ï¸</button>
            </div>
          </div>
        </div>

        <!-- DeepSeek -->
        <div class="card">
          <h3>
            DeepSeek
            <span class="key-status missing" id="status-deepseek">âœ— No key</span>
          </h3>
          <div class="row">
            <label>API Key</label>
            <div class="input-wrapper">
              <input id="deepseek_key" type="password" placeholder="sk-..." autocomplete="off" aria-label="DeepSeek API Key" />
              <button type="button" class="toggle-password" data-target="deepseek_key" title="Show/Hide" aria-label="Toggle password visibility">ğŸ‘ï¸</button>
            </div>
          </div>
        </div>

        <!-- Azure OpenAI -->
        <div class="card">
          <h3>
            Azure OpenAI
            <span class="key-status missing" id="status-azure">âœ— Not configured</span>
          </h3>
          <div class="row">
            <label>API Key</label>
            <div class="input-wrapper">
              <input id="azure_api_key" type="password" placeholder="Azure key" autocomplete="off" aria-label="Azure OpenAI API Key" />
              <button type="button" class="toggle-password" data-target="azure_api_key" title="Show/Hide" aria-label="Toggle password visibility">ğŸ‘ï¸</button>
            </div>
          </div>
          <div class="row">
            <label>Endpoint</label>
            <input id="azure_endpoint" placeholder="https://...openai.azure.com" autocomplete="off" aria-label="Azure Endpoint" />
          </div>
          <div class="row">
            <label>Deployment</label>
            <input id="azure_deployment" placeholder="gpt-4o-mini" autocomplete="off" aria-label="Azure Deployment" />
          </div>
          <div class="row">
            <label>API Version</label>
            <input id="azure_api_version" placeholder="2024-02-01" value="2024-02-01" autocomplete="off" aria-label="Azure API Version" />
          </div>
          <div class="provider-hint">ğŸ’¡ All 4 fields required for Azure</div>
        </div>

        <div class="btn-group" style="margin-top: 16px;">
          <button class="btn primary" id="saveSettings">ğŸ’¾ Save Settings</button>
          <button class="btn" id="exportSettings">ğŸ“¤ Export</button>
          <button class="btn" id="importSettings">ğŸ“¥ Import</button>
          <input type="file" id="importFile" accept=".json" style="display: none;" aria-label="Import settings file" />
        </div>
        <div class="status" id="settingsStatus"></div>
      </div>
    </details>

    <!-- System Prompt Preset -->
    <details id="promptSettings" open>
      <summary>
        <span>ğŸ’¬ System Prompt</span>
      </summary>
      <div>
        <div class="prompt-preset">
          <label>Preset:</label>
          <select id="promptPreset" aria-label="System prompt preset">
            <option value="default">Default (Helpful Assistant)</option>
            <option value="professional">Professional Email Expert</option>
            <option value="concise">Concise & Direct</option>
            <option value="friendly">Friendly & Casual</option>
            <option value="formal">Formal Business</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="custom-prompt hidden" id="customPromptBox">
          <label class="small">Custom System Prompt:</label>
          <textarea id="customPrompt" placeholder="Enter custom system prompt..." aria-label="Custom system prompt"></textarea>
        </div>
      </div>
    </details>
      </div><!-- End sidebar-content -->
    </aside><!-- End settings-sidebar -->

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
    <!-- Header with gradient title -->
    <header>
      <div>
        <h1>âœ¨ Email Assistant</h1>
        <p class="small" style="margin: 4px 0 0 0; opacity: 0.7;">Perfect your emails with AI</p>
      </div>
      <button class="theme-toggle" id="themeToggle" title="Toggle dark mode" aria-label="Toggle dark mode">ğŸŒ“</button>
    </header>

    <div class="divider"></div>

    <!-- Provider Selection -->
    <section aria-label="AI Provider Selection">
      <div class="provider-row">
        <label for="provider">Provider:</label>
        <select id="provider" aria-label="AI Provider">
          <option value="openai">OpenAI</option>
          <option value="anthropic">Anthropic (Claude)</option>
          <option value="google">Google Gemini</option>
          <option value="deepseek">DeepSeek</option>
          <option value="azure">Azure OpenAI</option>
        </select>
        <input id="model" placeholder="Model (optional)" style="max-width: 150px;" aria-label="Model name (optional)" />
      </div>
      <div class="status" id="providerStatus"></div>
    </section>

    <!-- Quick Actions -->
    <section aria-label="Quick Actions">
      <div class="quick-actions">
        <button class="btn" id="grabSelection" title="Use selected text from the current page">
          <span>ğŸ“‹</span> Use Selection
        </button>
        <button class="btn" id="pasteFromClipboard" title="Paste from clipboard">
          <span>ğŸ“„</span> Paste
        </button>
      </div>
    </section>

    <!-- Email Chain / Background Context -->
    <details id="contextSettings">
      <summary>
        <span>ğŸ“§ Email Chain / Context (Optional)</span>
      </summary>
      <div>
        <p class="small" style="margin: 0 0 8px 0; color: var(--text-secondary);">
          Provide email chain or background context to help AI understand the conversation history and generate better responses.
        </p>
        <div class="textarea-wrapper">
          <textarea id="emailContext" placeholder="Paste previous email exchanges or context here...&#10;&#10;Example:&#10;From: john@example.com&#10;Subject: Re: Project Update&#10;Hi team, following up on yesterday's discussion...&#10;&#10;From: sarah@example.com&#10;Thanks for the update. I have a few questions..." aria-label="Email context input"></textarea>
          <div class="char-count" id="contextCharCount" aria-live="polite">0 / 8000</div>
          <button class="clear-textarea hidden" id="clearContext" title="Clear context" aria-label="Clear context text">âœ•</button>
        </div>
      </div>
    </details>

    <!-- Input Area -->
    <section aria-label="Email Input">
      <div class="textarea-wrapper">
        <textarea id="input" placeholder="Paste or type your email text here..." aria-label="Email text input"></textarea>
        <div class="char-count" id="charCount" aria-live="polite">0 / 4000</div>
        <button class="clear-textarea hidden" id="clearInput" title="Clear input" aria-label="Clear input text">âœ•</button>
      </div>
    </section>

    <!-- Operation Buttons -->
    <section aria-label="Email Operations">
      <div class="operations-grid">
        <button class="btn primary" id="revise" title="Revise for clarity and professionalism">
          <span>âœ¨</span> Revise
        </button>
        <button class="btn" id="makeFormal" title="Make more formal and professional">
          <span>ğŸ©</span> Formal
        </button>
        <button class="btn" id="makeCasual" title="Make more casual and friendly">
          <span>ğŸ˜Š</span> Casual
        </button>
        <button class="btn" id="shorten" title="Make more concise">
          <span>âœ‚ï¸</span> Shorten
        </button>
        <button class="btn" id="expand" title="Add more detail">
          <span>ğŸ“</span> Expand
        </button>
        <button class="btn danger hidden" id="cancelStream" title="Cancel current request">
          <span>â¹ï¸</span> Cancel
        </button>
      </div>
    </section>

    <!-- Status & Cost Estimate -->
    <div class="status" id="status" role="status" aria-live="polite"></div>
    <div class="cost-estimate hidden" id="costEstimate" aria-label="Token and cost estimate">
      <div class="cost-item">
        <label>Input Tokens</label>
        <div class="value" id="inputTokens">-</div>
      </div>
      <div class="cost-item">
        <label>Output Tokens</label>
        <div class="value" id="outputTokens">-</div>
      </div>
      <div class="cost-item">
        <label>Est. Cost</label>
        <div class="value" id="estimatedCost">-</div>
      </div>
    </div>

    <!-- Output Area -->
    <section aria-label="AI Response">
      <div class="out" id="output" role="region" aria-live="polite"></div>
    </section>

    <!-- Output Actions -->
    <div class="output-actions">
      <button class="btn" id="copyOutput" title="Copy to clipboard" disabled aria-label="Copy output to clipboard">
        <span>ğŸ“‹</span> Copy
      </button>
      <button class="btn" id="clearOutput" title="Clear output" disabled aria-label="Clear output">
        <span>ğŸ—‘ï¸</span> Clear
      </button>
      <button class="btn" id="downloadOutput" title="Download as text file" disabled aria-label="Download output as text file">
        <span>ğŸ’¾</span> Download
      </button>
      <button class="btn" id="toggleDiff" title="Compare with original" disabled aria-label="Toggle comparison view">
        <span>ğŸ”„</span> Compare
      </button>
      <div class="history-controls" role="navigation" aria-label="Response history">
        <button class="btn small" id="historyPrev" title="Previous version" disabled aria-label="Previous response">â†</button>
        <span id="historyInfo" aria-live="polite">-</span>
        <button class="btn small" id="historyNext" title="Next version" disabled aria-label="Next response">â†’</button>
      </div>
    </div>

    <!-- Diff View (Hidden by default) -->
    <div class="diff-view hidden" id="diffView" role="region" aria-label="Comparison view">
      <div class="diff-panel">
        <h4>Original</h4>
        <div class="content" id="diffOriginal"></div>
      </div>
      <div class="diff-panel">
        <h4>Revised</h4>
        <div class="content" id="diffRevised"></div>
      </div>
    </div>

    <!-- Footer with keyboard shortcuts hint -->
    <footer style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border-light); text-align: center;">
      <p class="small" style="margin: 0; opacity: 0.6;">
        ğŸ’¡ <strong>Tip:</strong> Press <kbd style="padding: 2px 6px; background: var(--btn-secondary-bg); border-radius: 4px; font-size: 11px;">Ctrl+Enter</kbd> to send
      </p>
    </footer>
    </main><!-- End main-content -->

    <script type="module" src="sidepanel.js"></script>
  </body>
</html>
